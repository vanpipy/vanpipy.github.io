# 历史前端工程项目调查报告
该报告讨论对象为历史前端工程, 其所包含的内容为文件结构, 依赖结构, 数据结构等.

## 摘要
业务级的前端工程一般具有如下特性：

* 文件体积大
* 依赖关系复杂
* 数据层级嵌套多

对于维护周期在两年以上的项目, 还可能存在, 新旧技术迭代, 引入依赖困难, 偏离了预设的标准规范和设计初衷等等问题.

当前调查便是发现前端工程在不断迭代的过程中, 针对以上特征产生的现象和分析.

## 简介
前端工程历经三年以上的业务开发周期, 以 jsx 为基础单元, 围绕 React 生态进行功能扩展.使用 React Router 进行入口级别的资源划分, 
使用 class 和 hooks component 进行组件级别的开发, 使用 React.Context 进行数据初始规划.以此为基础观察, 其结构应该简单透明, 不论
新增还是重构其面向的对象都应该是具备高内聚性的.不过实际情况却与之相反, 工程中存在大量离散性, 且无法进行有效管理的依赖关系, 对于建立
有效的抽象层级设置了大量障碍.同时在入口级别和一般的组件, 其对于数据的管理也并没有区分, 造成数据抽象无法同依赖关键进行映射.

## 发现
1. 从工程实体的角度出发, Entry, Pages, Components, Models, Services等不同的角色进行工程文件的组织, 以这种方式进行组织, 在理想条件下, 
确可以获得较小的冗余度, 在长久的开发周期之后可以获得尽可能小的工程体量.其代价是需要较为严格的代码审计.然而在较为紧张的开发周期下, 
开发者维持不同模块的依赖关系和建立简单清晰的约束面临很多挑战.

2. 从数据实体的角度出发, Entry, Pages, Models 可以看到应该有三个明显的抽象隔离, 以达到数据视图分离, 数据驱动视图展现的效果.不过实际情况是, 
很多可以归类到 Pages 的数据操作, 实际上是在其子组件中进行.这造成了 Models 和 Pages 的依赖状态并不是单向线性的, 可能是双向, 也可能是交叉的.

3. 从依赖关系的角度出发, 工程内容实际的展现, 如 Entry -> Pages -> Components 这样单项线性依赖可以满足, 然而对于 Modals, Services, 以及更为
进行细节描述的 Components,  其依赖关系表现为交叉形态.

4. 从单文件的角度出发, 一个组件内容包含的代码行数范围在 [200, 500], 不论作为入口文件或者是组件, 所包含的内容都超过了它的职责.反之, 与之对应
的数据操作文件, 则一般没有超过 100 行.

5. 从构建结果的角度出发, 由于业务体积不断增加, 编译的时间也不断增加, 而实际情况中, 单次启动构建耗时甚至超过了一分钟, 单次更新构建耗时
超过三十秒.对于快速的迭代周期来讲, 开发者将可见时间花在等待上, 将增大开发成本.

## 结论
前端工程实体对于原始的标准规范无法进行有效维护, 也无法维护简单透明的结构关系, 认识内在的关系和依赖的时间将越来越多, 同时也可能越来越困难, 
导致出现各类潜在的故障和困难的维护工作, 所以对于工程和数据实体都需要进行有效的治理, 使其趋向于原始的标准规范要求.

## 建议
* 文件组织治理

    1. 文件一级角色组织为 Entry, Pages, Store, Components, Utils.
    2. 文件二级功能组织为 Pages/[module].
    3. 文件三级结构组织为 Pages/module/[model, service, index, ...]

* 数据结构治理

    1. 数据一级组织为 Entry 
    2. 数据二级组织为 Page store

* 代码结构治理

    1. 提供处理数据的辅助函数
    2. 提供处理 Json DSL Form 的 SDK
    3. 拆分大体积视图模块为更小颗粒度的模块

以此建立简单沟通的依赖关系和单一可朔源的数据实体.

## 参考
* [Atomic Design](https://bradfrost.com/blog/post/atomic-web-design/)
* [React State and Lifecycle](https://reactjs.org/docs/state-and-lifecycle.html)
* [Hooks API reference](https://reactjs.org/docs/hooks-reference.html)
* [Building your own hooks](https://reactjs.org/docs/hooks-custom.html#using-a-custom-hook)
* [Hooks FAQ](https://reactjs.org/docs/hooks-faq.html)
