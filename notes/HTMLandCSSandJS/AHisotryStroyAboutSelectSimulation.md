
# 一段模拟下拉选择器的陈年旧事

> 温故而知新

## 引子
在大概较久之前的一段时光里面，有那么一段同Jquery和document进行紧密合作的日子。

某一天，发现select这个浏览器中都存在的表单控件，它在不同的浏览器居然不是一样的！
这简直和我想象的不太一样！(原谅那个时候的我并不知道什么是厂商爸爸)。

这怎么行，这个可爱的视图组件怎么能两面三刀。于是我要把他们变成一个样。虽然那个时候一开始不知道怎么变，但我可以学啊。

于是我开始了肝，哦，学习的过程。

## 回忆
首先我通过观察，确定了一个事实，那就是可以通过隐藏原生的select，再使用一个创建的元素占用select的位置，就可以达到暗度陈仓的效果。。

第一件事便是确立视图组成角色:

* 显示结果
* 候选者列表

使用这两种角色很容易就可以得到一种解决方法:

1. 使用一个div来显示选择的结果
2. 使用一个ul来显示所有的候选者
3. 通过监听ul中子元素和div的点击时间来控制ul的显示状态

So easy, mommy don't worry.

实现过程一帆风顺，直到我打开候选者列表并点击了一下模拟区域的外部空间... 这咋收不起来???
不过很快机智的我就反应过来了，没有反应才是正常逻辑，因为在刚才的方法中并没有涉及组件之外的元素。
只是这也不算完整的方案，于是我尝试增加了一点操作。

4. 监听document的点击时间并判断点击的时刻是否点击的是模拟部分的元素。

此时，终于得到一个完整功能的组件。

无法去评价这种做法的好坏，至少它在工作了。

## 这一刻
现在我们来到了这一刻，如若把回忆放到这一刻又该是什么光景?

> 尝试去完整的认识已知的事物

### 所有发生的情况
使用流程图可以快速的帮助开发者认知用户故事完整的流程, 按照现在的需要情况, 存在这样一种流程图.

```
                -------------------                     ----------------------------
                |                 |                     |                          |
                |                N|                     |                         N|
       Y        v        Y        |        Y            v              Y           |           Y                 Y                   Y
开始 -----> 选择器为空 -----> 点击选择器 -----> 展开选择器的备选列表 -----> 点击备选列表单元 -----> 更新选择器 -----> 收起备选列表 -----> 结束
                ^                 |                                                                                        ^
                |                Y|                                                                                        |
                |                 |                                                                                        |
                |     N           v            Y                                                                           |
                ------------- 点击选择器   ---------------------------------------------------------------------------------
```

自然的, 对于选择器, 尝试赋予它需要的数据属性以便表达其逻辑.

```
--------------------------------
| Selector                     |
|------------------------------|
| value<string>                |
| alternateList<array[string]> |
| isCollapose<boolean>         |
| select<function>             |
| open<function>               |
| close<function>              |
--------------------------------

--------------------------------
| Document                     |
|------------------------------|
| clickEventListener           |
| focusEventListener           |
| blurEventListener            |
--------------------------------
```

按照这样, 通过使用焦点管理的过程可以把整个选择器的内容都容纳在同一个模块中, 这解决了之前使用全局变量的问题. 而使用这样的模型建立, 可以很清晰的知道实现的过程是如何的, 解决了依赖直觉造成的不可知.
当我尝试如此这般过程, 可以很清晰的感知或者说看到实现是如何的, 它是可控的并且是可以交流的.

## 小结
到了这一刻, 心中翻涌, 可也不知道如何描述. 当在一个方向进行学习的时候, 最重要的学习内容应该是什么? 曾经我认为首要的是基础知识和基础关系, 而如今我认为基础思维也是同等重要的.

PS: 愿心中的理想引导你我.
